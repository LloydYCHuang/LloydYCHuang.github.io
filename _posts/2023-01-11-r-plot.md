---
layout: default
categories: R
title:  "從零開始使用R進行完整的科學繪圖 (持續更新)"
---  
## 從零開始使用R進行完整的科學繪圖 (持續更新)  
2023/01/11  
*最後更新：2023.01.16*  
在進行科學研究的時候，我們不可避免的需要繪製各種圖像來協助表達，這些需求包含但不限於口頭報告、海報、研討會以及期刊發表。一直以來，我們實驗室最常使用的應用程式就是SigmaPlot，不可否認這個程式有其厲害之處，但我認為R語言可以包辦從資料處理、分析到繪圖，是相當全面的，而且程式語言的重複使用性讓我們不用每次繪圖都重新開一個檔案畫一次，也是一項優勢。  
我無意比較哪種軟體最好，只有最適合自己的方法，今天就來介紹如何使用R語言來繪製一個精美且可以進行期刊投稿的科學繪圖！  
  
*謂學不暇給者，雖暇亦不能學  
&mdash;《淮南子·說山訓》*
  
## 示範資料：iris  
熟悉R語言的人一定都聽過這個資料集，但是由於標榜從零開始，我必須先介紹一下`iris`，也就是鳶尾花資料集。這是一個多變數資料集，內容包含著有關鳶尾花的不同變數，而且已經內建在每個R語言下載包內，是相當適合用於教學的資料，稍微查了一下這個資料集還跟統計學之父R.A.Fisher有關呢。  
使用這個資料集的方法就是呼叫他：  
```
data(iris)  # 呼叫iris資料集  
head(iris)  # 展示這個資料的前六個row  
```
執行上述程式碼後將可以獲得以下的內容  
```
  Sepal.Length Sepal.Width Petal.Length Petal.Width Species
1          5.1         3.5          1.4         0.2  setosa
2          4.9         3.0          1.4         0.2  setosa
3          4.7         3.2          1.3         0.2  setosa
4          4.6         3.1          1.5         0.2  setosa
5          5.0         3.6          1.4         0.2  setosa
6          5.4         3.9          1.7         0.4  setosa
```
這就是`iris`資料集內包含的五個變數，而整個`iris`資料集共有150筆樣本。`Sepal.Length`、`Sepal.Width`、`Petal.Length`及`Petal.Width`是連續變數，而`Species`則是類別變數，我們在繪圖時會常用到`Species`這個變數，例如要將不同樣品根據土壤母質、採樣地點等特性而標上不同的顏色，因此類別變數就會拿來示範這個功能。要取出一個資料集中的某個變數，需要使用`$`，例如我想要Sepal.Length這個變數資料，就輸入`iris$Sepal.Length`即可。接下來，我就利用這個資料集來示範繪製可用於期刊發表的圖。  
  
## 最基礎的plot函數  
在R語言中，`plot`函數是個最為基本，操作起來直觀的函數，雖然陽春，但可以細微調整的地方也相當多，可以用來簡單觀察資料型態，也可以進行期刊投稿，基本上可以應付大多數的目的。  
對於繪製散布圖而言，`plot`函數的組成是這樣的 (我只列出常會用到的參數)：  
```
plot(x, y = NULL,              # xy座標，必須輸入對應的數值 (1)
     type = "p",               # 指定線的種類 (2)
     xlim = NULL, ylim = NULL, # 指定畫出來的範圍
     log = "",                 # 輸入"x"代表x軸取對數，"y"跟"xy"同理
     main = NULL, sub = NULL,  # 標題名
     xlab = NULL, ylab = NULL, # 座標軸名，分x跟y
     ann = par("ann"),         # 要不要顯示座標軸名稱，邏輯值 (3)
     axes = TRUE,              # 要不要顯示座標軸，邏輯值
     frame.plot = axes,        # 圖要不要有外框，邏輯值
     asp = NA                  # x/y座標的長度比例 (4)
     ...)
```
1. 上面這個是函數的預設組成，而裡面包含許多的參數例如`x`, `y`, `type`, `xlim`等等，如果某個參數幫你附註了`= XXX`，例如`y = NULL`，代表這個參數有預設值，你若不指定這個參數就會自動代入，相反的如果沒有預設值，就代表你必須給予x一個數值，否則函數將出現error。  
2. "p"代表點，"l"代表線，"b"代表有線串聯的點， "c"代表沒有點的的虛線，"o"代表線會畫在點上面，"s"和"S"代表階梯圖，"h"代表直線狀的長條圖，"n"則會是空的沒有圖。  
3. 邏輯值代表這個值需要輸入`True`或`False`，在`plot`函數中如果不做任何事就會是`T`而顯示該項目，如果不想顯示該項目則可以用`F`來關掉。  
4. 最常見就是asp = 1代表xy座標比例要一樣。   
  
首先，我們先隨意繪製一張圖：  
`plot(x=iris$Sepal.Length, y=iris$Sepal.Width)`  
![image](https://drive.google.com/uc?export=view&id=1s5sJokbgSwq71htcVB77d3hdFUFRQ4aE)   
可以看到這就是繪圖方面最陽春的一種，沒有設定X軸、Y軸，也沒有其他美編，接下來我就要從這個圖開始畫出可以拿來用於發表的圖。  
通常需要注意的地方有幾個，可以跟著檢視自己的圖，讓我們從圖的外圍向內開始講：
1. X軸與Y軸需要有標題，且字體要大一點
2. X軸與Y軸是否需要客製範圍 (這裡示範將X軸改成0到8，Y軸改成0到5)，且字體要大一點  
3. 座標點要黑色更大  
  
```
plot(x = iris$Sepal.Length, y = iris$Sepal.Width,
     xlab = "Sepal Length", ylab = "Sepal Width",  # XY軸標題，注意文字要以" "包起來 
     cex.lab=1.3,                                  # 調整座標軸標題字體大小
     xlim = c(0,8), ylim = c(0,5),                 # 調整座標軸範圍
     cex.axis = 1.5,                               # 調整座標軸字體大小
     pch = 19,                                     # 將點變為黑色的(註)
     cex = 2.5                                     # 調整點的大小
     )
```
![image](https://drive.google.com/uc?export=view&id=16IRQkO7g6E39tXZfJ4AZt6teTZEg6g8C)  
註：pch這個參數代表點的形狀，我通常是喜歡用黑色圓點19，想使用空心點或是方形菱形可以參考<a href="http://www.sthda.com/english/wiki/r-plot-pch-symbols-the-different-point-shapes-available-in-r" target="_blank">這裡的圖</a>。  
  
然後我們還有一些常用的功能以及函數要介紹，首先是`abline()`，這是在圖上加線的函數，他的參數可以這樣設定：
```
abline(a = 0,   # 設定線的Y截距
       b = 1    # 設定線的斜率
       lwd = 1  # 設定線的粗細，數字越大越粗 (只要線都適用)
       )
abline(h = 3)   # 設定一條水平線，y=3
abline(v = 2)   # 設定一條水平線，x=2
```
  
接著是`text()`，可以幫助你加文字，參數是這樣：
```
text(x = 2, y = 4, # XY座標
     "1:1 Line",   # 文字內容，一樣要用" "包起來
     cex = 1.2,    # 字體大小
     pos = 1       # 字要在選定XY座標的下左上右方 (分別對應1234)
     offset = 1    # 如果有使用pos，那麼要在那個方向距離中心多遠 
     )
```
  
接著，就讓我們實際繪製一張包含有上述幾種功能的圖吧
```
plot(x = iris$Sepal.Length, y = iris$Sepal.Width,
     xlab = "Sepal Length", ylab = "Sepal Width", 
     cex.lab=1.3,
     xlim = c(0,8), ylim = c(0,8),
     cex.axis=1.5,
     pch=19, 
     cex=2.5
     )
abline(a=0,b=1,lwd=2)
text(x=7, y=6, "1:1 Line", 
     cex=1.4)
```
![image](https://drive.google.com/uc?export=view&id=12JDvLWEs2rkOexTdpEugfjknFUTlZF4K)   



